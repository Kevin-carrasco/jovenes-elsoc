"0","load(file = here::here(""input/data-proc/df_study1_long_t7.RData""))"
"0","df_study1 <- df_study1_long_t7 %>% dplyr::select(idencuesta,ola, segmento, estrato, ponderador_long_total,"
"0","                                                 part_marchas,"
"0","                                                 edad) %>% na.omit()"
"0","df_study1 <- df_study1[complete.cases(df_study1$segmento), ]"
"0",""
"0","df_study1$part_marchas <- factor(df_study1$part_marchas,"
"0","         labels = c(""Nunca"", ""Casi nunca"", ""A veces"", ""Frecuentemente"", ""Muy "
"0","frecuentemente""))"
"0",""
"0","elsoc_diseno <- svydesign(ids = ~segmento, #muestreo por conglomerado a nivel de manzanas (segmento)"
"0","                          strata = ~estrato, #muestreo estratificado a nivel ciudad (estato)"
"0","                          weights = ~ponderador_long_total, #ponderador longitudinal"
"0","                          nest = TRUE,"
"0","                          data = df_study1)"
"0",""
"0",""
"0","#Paso 1"
"0","datos.marchar <- data.frame((svytable(~part_marchas + ola + idencuesta, elsoc_diseno, round = F))) %>% "
"0","  dplyr::filter(Freq>0)  %>% group_by(ola) %>% "
"0","  mutate(porcentaje=Freq/sum(Freq)) %>% na.omit()"
"0",""
"0","#Paso 2"
"0","etiquetas.marchar <- data.frame((svytable(~part_marchas + ola, elsoc_diseno, round = F))) %>% "
"0","  group_by(ola) %>% mutate(porcentaje=Freq/sum(Freq)) %>% na.omit() %>% "
"0","  mutate(idencuesta = 1)"
"0",""
"0","datos.marchar$part_marchas <- factor(datos.marchar$part_marchas, levels = rev(levels(datos.marchar$part_marchas)))"
"0","etiquetas.marchar$part_marchas <- factor(etiquetas.marchar$part_marchas, levels = rev(levels(etiquetas.marchar$part_marchas)))"
"0",""
"0","ggplot(datos.marchar, aes(x = ola, fill = part_marchas, stratum = part_marchas,"
"0","                             alluvium = idencuesta, y = porcentaje))+"
"0","    ggalluvial::geom_flow(alpha = .66) + "
"0","    ggalluvial::geom_stratum(linetype = 0) +"
"0","    scale_y_continuous(labels = scales::percent) + "
"0","    ylab(label = NULL) +"
"0","    xlab(label = NULL) + "
"0","    theme(#legend.position = 'top',"
"0","          legend.title = element_blank(),"
"0","          plot.caption = element_text(hjust = 1)) +"
"0","    scale_fill_manual(values = colors) +"
"0","    geom_shadowtext(data = etiquetas.marchar, "
"0","              aes(label = ifelse(porcentaje > 0 , scales::percent(porcentaje, accuracy = .1),"""")),"
"0","              position = position_stack(vjust = .5),"
"0","              show.legend = FALSE,"
"0","              size = 4,"
"0","              color = rep('white'),"
"0","              bg.colour='grey30')+"
"0","  scale_x_discrete(labels = c(2016, 2017, 2018, 2019, 2021, 2022, 2023))"
